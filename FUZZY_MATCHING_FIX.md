# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: Fuzzy-–ø–æ–¥—Å–∫–∞–∑–∫–∏ –¥–ª—è get_table_schema

## –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –≤—ã–∑–æ–≤–µ `get_table_schema` —Å **–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –Ω–∞–∑–≤–∞–Ω–∏–µ–º —Ç–∞–±–ª–∏—Ü—ã**, –±—ç–∫–µ–Ω–¥ –≤–æ–∑–≤—Ä–∞—â–∞–ª fuzzy-–ø–æ–¥—Å–∫–∞–∑–∫–∏ –≤ –ø–æ–ª–µ `message`, –Ω–æ UI **–Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–ª –∏—Ö**, –ø–æ–∫–∞–∑—ã–≤–∞—è —Ç–æ–ª—å–∫–æ –∫–æ—Ä–æ—Ç–∫–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ –∏–∑ –ø–æ–ª—è `error`.

### –ü—Ä–∏–º–µ—Ä –ø—Ä–æ–±–ª–µ–º—ã

**–ó–∞–ø—Ä–æ—Å:**
```
get_table_schema("—Å–≤–æ–¥_–≤–ø–æ1_–≤—Å–µ–≥–æ_—Ä2_1_2_1")  # –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ
```

**–û—Ç–≤–µ—Ç –±—ç–∫–µ–Ω–¥–∞ (Python):**
```json
{
  "success": false,
  "error": "–¢–∞–±–ª–∏—Ü–∞ '—Å–≤–æ–¥_–≤–ø–æ1_–≤—Å–µ–≥–æ_—Ä2_1_2_1' –Ω–µ –Ω–∞–π–¥–µ–Ω–∞",
  "suggestions": [
    "—Å–≤–æ–¥_–≤–ø–æ1_–≤—Å–µ–≥–æ_—Ä2_1_21",
    "—Å–≤–æ–¥_–≤–ø–æ1_–≤—Å–µ–≥–æ_—Ä2_1_2_2",
    "—Å–≤–æ–¥_–≤–ø–æ1_–≤—Å–µ–≥–æ_—Ä2_1_2_3",
    "—Å–≤–æ–¥_–≤–ø–æ1_–≤—Å–µ–≥–æ_—Ä2_1_2_4",
    "—Å–≤–æ–¥_–≤–ø–æ1_–≤—Å–µ–≥–æ_—Ä2_1_5_1"
  ],
  "message": "‚ùå –¢–∞–±–ª–∏—Ü–∞ '—Å–≤–æ–¥_–≤–ø–æ1_–≤—Å–µ–≥–æ_—Ä2_1_2_1' –Ω–µ –Ω–∞–π–¥–µ–Ω–∞\n\nüí° –í–æ–∑–º–æ–∂–Ω–æ, –≤—ã –∏–º–µ–ª–∏ –≤ –≤–∏–¥—É –æ–¥–Ω—É –∏–∑ —ç—Ç–∏—Ö —Ç–∞–±–ª–∏—Ü:\n  ‚Ä¢ —Å–≤–æ–¥_–≤–ø–æ1_–≤—Å–µ–≥–æ_—Ä2_1_21\n  ‚Ä¢ —Å–≤–æ–¥_–≤–ø–æ1_–≤—Å–µ–≥–æ_—Ä2_1_2_2\n  ‚Ä¢ ...\n\nüîç –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤—ã–∑–≤–∞—Ç—å get_table_schema —Å –æ–¥–Ω–∏–º –∏–∑ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã—Ö –Ω–∞–∑–≤–∞–Ω–∏–π."
}
```

**–ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–ª UI –¥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```
‚ùå –û—à–∏–±–∫–∞
–¢–∞–±–ª–∏—Ü–∞ '—Å–≤–æ–¥_–≤–ø–æ1_–≤—Å–µ–≥–æ_—Ä2_1_2_1' –Ω–µ –Ω–∞–π–¥–µ–Ω–∞
```

**–ß—Ç–æ –±—ã–ª–æ —É—Ç–µ—Ä—è–Ω–æ:**
- –°–ø–∏—Å–æ–∫ –∏–∑ 5 –ø–æ—Ö–æ–∂–∏—Ö —Ç–∞–±–ª–∏—Ü (`suggestions`)
- –ü–æ–¥—Å–∫–∞–∑–∫–∞ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –Ω–∞–∑–≤–∞–Ω–∏—è–º–∏

---

## –†–µ—à–µ–Ω–∏–µ

### 1. –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ UI ([web_frontend_v2/ui.js:597-628](web_frontend_v2/ui.js#L597-L628))

–î–æ–±–∞–≤–∏–ª–∏ –ª–æ–≥–∏–∫—É –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è fuzzy-–ø–æ–¥—Å–∫–∞–∑–æ–∫:

```javascript
} else if (result.error) {
    // üîß FIX: –ü–æ–∫–∞–∑—ã–≤–∞–µ–º fuzzy-–ø–æ–¥—Å–∫–∞–∑–∫–∏ –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å
    let errorContent = '';

    if (result.suggestions && result.suggestions.length > 0) {
        // –ï—Å—Ç—å fuzzy –ø–æ–¥—Å–∫–∞–∑–∫–∏ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫—Ä–∞—Å–∏–≤–æ
        const suggestionsHTML = result.suggestions.map(name =>
            `<div class="suggestion-item">${getIcon('arrow-right', 12)} <code>${name}</code></div>`
        ).join('');

        errorContent = `
            <div class="tool-argument" style="color: #f44336;">${result.error}</div>
            <div class="tool-argument" style="margin-top: 12px;">
                <strong>${getIcon('lightbulb', 14)} –í–æ–∑–º–æ–∂–Ω–æ, –≤—ã –∏–º–µ–ª–∏ –≤ –≤–∏–¥—É:</strong>
                <div class="suggestions-list" style="margin-top: 8px;">
                    ${suggestionsHTML}
                </div>
            </div>
        `;
    } else if (result.message) {
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º message –≤–º–µ—Å—Ç–æ error, –µ—Å–ª–∏ –æ–Ω–æ –µ—Å—Ç—å
        errorContent = `<div class="tool-argument" style="color: #f44336; white-space: pre-wrap;">${result.message}</div>`;
    } else {
        // –ü—Ä–æ—Å—Ç–∞—è –æ—à–∏–±–∫–∞
        errorContent = `<div class="tool-argument" style="color: #f44336;">${result.error}</div>`;
    }

    resultSection.innerHTML = `
        <div class="tool-section-title">${getIcon('x-circle', 12)} –û—à–∏–±–∫–∞</div>
        ${errorContent}
    `;
    if (window.lucide) lucide.createIcons();
}
```

**–õ–æ–≥–∏–∫–∞:**
1. –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –ø–æ–ª—è `suggestions` (–º–∞—Å—Å–∏–≤ –ø–æ—Ö–æ–∂–∏—Ö —Ç–∞–±–ª–∏—Ü)
2. –ï—Å–ª–∏ –µ—Å—Ç—å ‚Äî –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º –∏—Ö –∫—Ä–∞—Å–∏–≤–æ —Å –∏–∫–æ–Ω–∫–∞–º–∏
3. –ï—Å–ª–∏ –Ω–µ—Ç ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º `message` –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ `error`

### 2. –°—Ç–∏–ª–∏ –¥–ª—è –ø–æ–¥—Å–∫–∞–∑–æ–∫ ([web_frontend_v2/style.css:620-654](web_frontend_v2/style.css#L620-L654))

–î–æ–±–∞–≤–∏–ª–∏ –∫—Ä–∞—Å–∏–≤—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –ø–æ–¥—Å–∫–∞–∑–æ–∫:

```css
/* üí° Fuzzy-–ø–æ–¥—Å–∫–∞–∑–∫–∏ –¥–ª—è —Ç–∞–±–ª–∏—Ü */
.suggestions-list {
    display: flex;
    flex-direction: column;
    gap: 6px;
}

.suggestion-item {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 12px;
    background: #FFF8E1;
    border-left: 3px solid #FFA726;
    border-radius: 4px;
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    font-size: 13px;
    color: #333;
    transition: all 0.2s ease;
}

.suggestion-item:hover {
    background: #FFE0B2;
    transform: translateX(4px);
    cursor: pointer;
}

.suggestion-item code {
    background: rgba(0, 0, 0, 0.05);
    padding: 2px 6px;
    border-radius: 3px;
    font-family: 'Courier New', monospace;
    font-size: 12px;
    color: #D84315;
}
```

**–î–∏–∑–∞–π–Ω:**
- –¢–µ–ø–ª—ã–π –∂–µ–ª—Ç—ã–π —Ñ–æ–Ω (#FFF8E1) —Å –æ—Ä–∞–Ω–∂–µ–≤–æ–π –ª–µ–≤–æ–π –≥—Ä–∞–Ω–∏—Ü–µ–π
- Hover —ç—Ñ—Ñ–µ–∫—Ç (—Å–≤–µ—Ç–ª–µ–µ + —Å–¥–≤–∏–≥ –≤–ø—Ä–∞–≤–æ)
- –ú–æ–Ω–æ—à–∏—Ä–∏–Ω–Ω—ã–π —à—Ä–∏—Ñ—Ç –¥–ª—è –Ω–∞–∑–≤–∞–Ω–∏–π —Ç–∞–±–ª–∏—Ü

---

## –†–µ–∑—É–ª—å—Ç–∞—Ç

**–¢–µ–ø–µ—Ä—å UI –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç:**

```
‚ùå –û—à–∏–±–∫–∞
–¢–∞–±–ª–∏—Ü–∞ '—Å–≤–æ–¥_–≤–ø–æ1_–≤—Å–µ–≥–æ_—Ä2_1_2_1' –Ω–µ –Ω–∞–π–¥–µ–Ω–∞

üí° –í–æ–∑–º–æ–∂–Ω–æ, –≤—ã –∏–º–µ–ª–∏ –≤ –≤–∏–¥—É:
  ‚Üí —Å–≤–æ–¥_–≤–ø–æ1_–≤—Å–µ–≥–æ_—Ä2_1_21
  ‚Üí —Å–≤–æ–¥_–≤–ø–æ1_–≤—Å–µ–≥–æ_—Ä2_1_2_2
  ‚Üí —Å–≤–æ–¥_–≤–ø–æ1_–≤—Å–µ–≥–æ_—Ä2_1_2_3
  ‚Üí —Å–≤–æ–¥_–≤–ø–æ1_–≤—Å–µ–≥–æ_—Ä2_1_2_4
  ‚Üí —Å–≤–æ–¥_–≤–ø–æ1_–≤—Å–µ–≥–æ_—Ä2_1_5_1
```

**–° –≤–∏–∑—É–∞–ª—å–Ω—ã–º–∏ —É–ª—É—á—à–µ–Ω–∏—è–º–∏:**
- –ö–∞–∂–¥–∞—è –ø–æ–¥—Å–∫–∞–∑–∫–∞ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π —Ä–∞–º–∫–µ
- –ò–∫–æ–Ω–∫–∞ —Å—Ç—Ä–µ–ª–∫–∏ ‚Üí –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º –Ω–∞–∑–≤–∞–Ω–∏–µ–º
- Hover —ç—Ñ—Ñ–µ–∫—Ç –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏
- –ù–∞–∑–≤–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü –≤ `<code>` –±–ª–æ–∫–∞—Ö

---

## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç Fuzzy Matching

**–ê–ª–≥–æ—Ä–∏—Ç–º:** –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –õ–µ–≤–µ–Ω—à—Ç–µ–π–Ω–∞ (Levenshtein Distance)

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `max_suggestions = 5` ‚Äî –º–∞–∫—Å–∏–º—É–º 5 –ø–æ–¥—Å–∫–∞–∑–æ–∫
- `max_distance = max(len(table_name) * 0.3, 3)` ‚Äî –º–∞–∫—Å–∏–º—É–º 30% –æ—Ç –¥–ª–∏–Ω—ã –Ω–∞–∑–≤–∞–Ω–∏—è

**–ü—Ä–∏–º–µ—Ä:**
```
–ò—Å–∫–æ–º–æ–µ: "—Å–≤–æ–¥_–≤–ø–æ1_–≤—Å–µ–≥–æ_—Ä2_1_2_1"  (24 —Å–∏–º–≤–æ–ª–∞)
–ù–∞–π–¥–µ–Ω–æ:  "—Å–≤–æ–¥_–≤–ø–æ1_–≤—Å–µ–≥–æ_—Ä2_1_21"   (23 —Å–∏–º–≤–æ–ª–∞, distance=1)
          "—Å–≤–æ–¥_–≤–ø–æ1_–≤—Å–µ–≥–æ_—Ä2_1_2_2"  (24 —Å–∏–º–≤–æ–ª–∞, distance=1)
          ...

max_distance = max(24 * 0.3, 3) = 7.2 ‚Üí –≤—Å–µ —Å distance ‚â§ 7 –ø–æ–ø–∞–¥—É—Ç –≤ —Å–ø–∏—Å–æ–∫
```

**–ö–æ–¥ (Python):**
- [sql_tool.py:450-507](../skynet_simple/tools/rag/sql_tool.py#L450-L507) ‚Äî —Ñ—É–Ω–∫—Ü–∏–∏ `_levenshtein_distance` –∏ `_find_similar_table_names`
- [sql_tool.py:550-606](../skynet_simple/tools/rag/sql_tool.py#L550-L606) ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ fuzzy matching –≤ `get_table_schema_tool`

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–°–æ–∑–¥–∞–Ω —Ç–µ—Å—Ç: [test_fuzzy_ui.py](test_fuzzy_ui.py)

**–ó–∞–ø—É—Å–∫:**
```bash
python3 test_fuzzy_ui.py
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```
======================================================================
–¢–ï–°–¢ FUZZY MATCHING –î–õ–Ø GET_TABLE_SCHEMA
======================================================================

üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–∞–±–ª–∏—Ü—É: '—Å–≤–æ–¥_–≤–ø–æ1_–≤—Å–µ–≥–æ_—Ä2_1_2_1'

‚ùå –¢–∞–±–ª–∏—Ü–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ (0 –∫–æ–ª–æ–Ω–æ–∫)

üí° –ù–∞–π–¥–µ–Ω–æ 5 –ø–æ—Ö–æ–∂–∏—Ö —Ç–∞–±–ª–∏—Ü:

  ‚Ä¢ —Å–≤–æ–¥_–≤–ø–æ1_–≤—Å–µ–≥–æ_—Ä2_1_21 (distance=1)
  ‚Ä¢ —Å–≤–æ–¥_–≤–ø–æ1_–≤—Å–µ–≥–æ_—Ä2_1_2_2 (distance=1)
  ‚Ä¢ —Å–≤–æ–¥_–≤–ø–æ1_–≤—Å–µ–≥–æ_—Ä2_1_2_3 (distance=1)
  ‚Ä¢ —Å–≤–æ–¥_–≤–ø–æ1_–≤—Å–µ–≥–æ_—Ä2_1_2_4 (distance=1)
  ‚Ä¢ —Å–≤–æ–¥_–≤–ø–æ1_–≤—Å–µ–≥–æ_—Ä2_1_5_1 (distance=1)
```

---

## –ò—Ç–æ–≥

‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:** UI —Ç–µ–ø–µ—Ä—å –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç fuzzy-–ø–æ–¥—Å–∫–∞–∑–∫–∏ –ø—Ä–∏ –æ—à–∏–±–∫–µ "—Ç–∞–±–ª–∏—Ü–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞"
‚úÖ **–ë—ç–∫–µ–Ω–¥:** Fuzzy matching —É–∂–µ —Ä–∞–±–æ—Ç–∞–ª, –ø—Ä–æ—Å—Ç–æ UI –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–ª —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
‚úÖ **UX:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç 5 –ø–æ—Ö–æ–∂–∏—Ö —Ç–∞–±–ª–∏—Ü –∏ –º–æ–∂–µ—Ç –≤—ã–±—Ä–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—É—é
‚úÖ **–î–∏–∑–∞–π–Ω:** –ö—Ä–∞—Å–∏–≤–æ–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ —Å –∏–∫–æ–Ω–∫–∞–º–∏ –∏ hover —ç—Ñ—Ñ–µ–∫—Ç–∞–º–∏

**–î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** 2025-10-24
**–ê–≤—Ç–æ—Ä:** Claude Code (Sonnet 4.5)
